<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Custom Forms</title>
    <meta name="description" content="Custom Forms">
    <meta name="Sean Fallmann" content="FormDeployment">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src='https://www.google.com/recaptcha/api.js'></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.css">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.js'></script>



  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<style>

    .dropzone-previews {
        width: 200px;
    }

    .dropzone {
        border: none;
    }
</style>
<body >
    <br/>
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12">
                {{ header }}
            </div>
        </div>
        <div class="row">
            <div class="col-xs-2">
            </div>
            <div class="col-xs-8">
                {% load crispy_forms_tags %}
                {% crispy form form.helper %}
            </div>
            <div class="col-xs-2">
            </div>
        </div>
        <div class="row">
            <div class="col-xs-2">
            </div>
            <div class="col-xs-12">
                {{ footer }}
            </div>
            <div class="col-xs-2">
            </div>
        </div>
    </div>



</body>

<script>
    $(window).load(function() {
        console.log("Form resetting!");
        $('form').get(0).reset(); //clear form data on page load
    });


    function getCookie(name)
    {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?

                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    $.ajaxSetup({
         beforeSend: function(xhr, settings) {
             if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                 // Only send the token to relative URLs i.e. locally.
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             }
         }
    });

    $(function() {

        var formId = $("form").attr("id");
        var hidden = $("[data-dropzone]");
        var id = hidden.attr("id") + "_div";

        var maxFiles = hidden.data("limit");
        var maxSize = 500 / maxFiles;

        var dropzoneDiv = $("<div />", {
            "name": id,
            "id": id,

            "class": "dropzone-previews col-xs-8",
        });

        hidden.after(dropzoneDiv);

        Dropzone.autoDiscover = false;
        $("#"+formId).addClass("dropzone");
        // or disable for specific dropzone:
        // Dropzone.options.myDropzone = false;

        previewId = "#"+id;
        $("<div id=" + previewId +  "></div>");
        $("<img id='dz-pic' class='dz-default dz-message' src='http://doublemesh.com/wp-content/uploads/2013/09/Dropzone.jpg'/>");

        options = {
            //url: action,
            //parallelUploads: 2,
            uploadMultiple: true,
            maxFilesize: maxSize,
            addRemoveLinks: true,
            createImageThumbnails: true,
            maxFiles: maxFiles,
            autoProcessQueue: false,
            dictDefaultMessage: "<img id='dz-pic' class='dz-default dz-message' src='http://doublemesh.com/wp-content/uploads/2013/09/Dropzone.jpg'/>",
            //clickable: '#dz-pic',
            previewsContainer: previewId,
        };


          // Now that the DOM is fully loaded, create the dropzone, and setup the
          // event listeners
        var myDropzone = new Dropzone("#"+formId, options);


        $("#submit-id-submit").click(function(e){

            e.preventDefault();
            e.stopPropagation();
            myDropzone.processQueue();
        });


        myDropzone.on("addedfile", function(file) {
            /* Maybe display some more file information on your page */
        });
    })


</script>

</html>
